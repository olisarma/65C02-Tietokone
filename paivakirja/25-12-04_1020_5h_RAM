## 25-12-04   10.20 5h 20min RAM ja oskillaattori

Tällä kerralla lisäsimme RAMin(AS6C62256) ja korvasimme itse tehdyn kellomoduulin 1mHz oskillaattorilla.

### RAM

Lisäsimme koneeseen RAMin, jotta pystyisimme suorittamaan aliohjelmia. RAMia tarvitaan tähän siksi, koska prosessori käyttää RAMissa olevaa pinoa(stack) muistaakseen mihin kohtaan ohjelmaa pitää palata. Aliohjelmien avulla ohjelmaa saadaan lyhennettyä ja sitä on helpompi laajentaa myöhemmin.

Stack on RAMissa, koska sinne kirjoitetaan koko ajan uutta tietoa tai vanhaa tietoa poistetaan, eli sen sisältö muuttuu jatkuvasti. ROM(Read Only Memory) ei sovi tähän, sillä siihen ei voi kirjoittaa.

## Logiikka

Yhdistimme ROMin ja RAMin osoite- ja datalinjat keskenään sekä kytkimme prosessorin RWB-signaalin RAMin WE#-pinniin (Write Enable). Tämän jälkeen CPU:n osoiteväylä (A0–A15) on yhdistetty I/O-ohjainpiiriin, ROMiin ja RAMiin, eli kaikki laitteet ovat samassa osoiteavaruudessa.

Jotta sama osoite ei aktivoisi useampaa piiriä yhtä aikaa, toteutimme osoitedekoodauksen lisäämällä logiikkaa prosessorin ja muistipiirien väliin. Osoitebittejä hyödyntämällä määriteltiin, mikä piiri on aktiivinen kullakin osoitealueella.

-> ROMin CE-signaali kytkettiin siten, että ROM aktivoituu vain silloin, kun osoitebitin A15 arvo on 1. 
-> RAMin CE-signaali puolestaan aktivoituu vain, kun A15 = 0 ja A14 = 0.
-> I/O-ohjainpiirin CE-signaali muodostettiin vielä eri osoitebittien yhdistelmästä. Näin varmistettiin, että vain yksi piiri vastaa kerrallaan ja vältetään väyläkonfliktien synty.


### Testaus ja pino(stack)

Kun CPU suorittaa aliohjelmakutsun, se hyppää aliohjelmaan ja sen täytyy muistaa, mistä kohtaa se hyppäsi. Paluuosoite tallennetaan muistiin pinoon(stack). Pino sijaitsee RAMissa. Kun aliohjelman suoritus loppuu, CPU hakee osoitteen pinosta ja osaa sitten jatkaa ohjelman suoritusta taas oikeasta kohtaa.

Testasimme RAMin toimintaa ajamalla uuden koodin, joka kirjoittaa saman teksin näytölle, nyt käyttämällä pinoa(stack). Koodi ei toimisi ilman RAMia.

### Oskillaattrorin lisäys

Lisäsimme vielä lopuksi oskillaattorin ja irrotimme vanhan kellomoduulin.

Tämän kerran päätteeksi opin mihin RAMia tarkemmin tarvitaan ja opin tarkemmin pinon toimintaa tietokoneessa. Opin myös tarkemmin mitä osoitedekoodaus tarkoittaa. Vaikka teimme sen jo aeimmin I/O-ohjainpiirin kanssa, niin en tullut ajatelleeksi asiaa tarkemmin, kuin vasta nyt.
